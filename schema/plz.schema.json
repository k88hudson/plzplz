{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "PlzConfig",
  "type": "object",
  "properties": {
    "extends": {
      "description": "Global defaults that apply to all tasks (can be overridden per-task)",
      "anyOf": [
        {
          "$ref": "#/$defs/GlobalSettings"
        },
        {
          "type": "null"
        }
      ]
    },
    "taskgroup": {
      "description": "Task groups for namespacing related tasks (e.g. [taskgroup.rust.test])",
      "type": [
        "object",
        "null"
      ],
      "additionalProperties": {
        "$ref": "#/$defs/TaskGroup"
      }
    },
    "tasks": {
      "description": "Tasks to run, keyed by name (e.g. [tasks.build]). Run with `plz <name>`.",
      "type": "object",
      "additionalProperties": {
        "$ref": "#/$defs/Task"
      }
    }
  },
  "$defs": {
    "GlobalSettings": {
      "type": "object",
      "properties": {
        "dir": {
          "description": "Default working directory (relative to plz.toml) for all tasks",
          "type": [
            "string",
            "null"
          ],
          "default": null
        },
        "env": {
          "description": "Tool environment wrapper applied to all tasks: \"pnpm\", \"npm\", or \"uv\"",
          "type": [
            "string",
            "null"
          ],
          "default": null
        }
      }
    },
    "Task": {
      "type": "object",
      "properties": {
        "description": {
          "description": "Description shown in `plz list`",
          "type": [
            "string",
            "null"
          ],
          "default": null
        },
        "dir": {
          "description": "Working directory (relative to plz.toml)",
          "type": [
            "string",
            "null"
          ],
          "default": null
        },
        "env": {
          "description": "Tool environment wrapper: \"pnpm\" (uses `pnpm exec`), \"npm\" (uses `npx`), or \"uv\" (uses `uv run`)",
          "type": [
            "string",
            "null"
          ],
          "default": null
        },
        "fail_hook": {
          "description": "Action to take when the task fails: a command string, { suggest_command = \"...\" }, or { message = \"...\" }",
          "anyOf": [
            {
              "oneOf": [
                {
                  "description": "Shell command to run on failure",
                  "type": "string"
                },
                {
                  "type": "object",
                  "properties": {
                    "suggest_command": {
                      "description": "Command to suggest to the user on failure",
                      "type": "string"
                    }
                  },
                  "additionalProperties": false,
                  "required": [
                    "suggest_command"
                  ]
                },
                {
                  "type": "object",
                  "properties": {
                    "message": {
                      "description": "Message to display on failure",
                      "type": "string"
                    }
                  },
                  "additionalProperties": false,
                  "required": [
                    "message"
                  ]
                }
              ]
            },
            {
              "type": "null"
            }
          ]
        },
        "git_hook": {
          "description": "Git hook stage to associate this task with (e.g. \"pre-commit\", \"pre-push\")",
          "type": [
            "string",
            "null"
          ],
          "default": null
        },
        "run": {
          "description": "A single shell command to run",
          "type": [
            "string",
            "null"
          ],
          "default": null
        },
        "run_parallel": {
          "description": "Multiple commands to run concurrently",
          "type": [
            "array",
            "null"
          ],
          "default": null,
          "items": {
            "type": "string"
          }
        },
        "run_serial": {
          "description": "Multiple commands to run one after another (stops on first failure)",
          "type": [
            "array",
            "null"
          ],
          "default": null,
          "items": {
            "type": "string"
          }
        }
      }
    },
    "TaskGroup": {
      "description": "A group of related tasks with optional shared defaults",
      "type": "object",
      "properties": {
        "extends": {
          "$ref": "#/$defs/GlobalSettings"
        }
      },
      "additionalProperties": {
        "$ref": "#/$defs/Task"
      }
    }
  }
}
